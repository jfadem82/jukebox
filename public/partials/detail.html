<h1>Playlist: {{usersCtrl.playlist.name}}</h1>

<!-- calls on submision and automatically prevents event.preventDefault() -->
<!-- <h4>This is the id I'm looking for: {{usersCtrl.playlist.songs[0].id}}</h4> -->
<iframe id="sc-widget" ng-src="{{usersCtrl.url | trustAsResourceUrl}}" width="25%" height="25%" scrolling="no" frameborder="no"></iframe>

<!-- +{{usersCtrl.playlist.songs[0].id}}+'"' -->
<script src="https://w.soundcloud.com/player/api.js" type="text/javascript"></script>
<script type="text/javascript">
  (function(){
    //document.getElementById('sc-widget').setAttribute('src','https://w.soundcloud.com/player/?url=https://api.soundcloud.com/tracks/47721763')
    //{{usersCtrl.url}}
    var widgetIframe = document.getElementById('sc-widget'),
        widget       = SC.Widget(widgetIframe);

    widget.bind(SC.Widget.Events.READY, function() {
      widget.bind(SC.Widget.Events.PLAY, function() {
        // get information about currently playing sound
        widget.getCurrentSound(function(currentSound) {
          console.log('sound ' + currentSound.get('') + 'began to play');
        });
      });
      // get current level of volume
      widget.getVolume(function(volume) {
        //console.log('current volume value is ' + volume);
      });
      // set new volume level
      widget.setVolume(50);
      // get the value of the current position
      widget.getDuration(function(duration) {
        //console.log("duration",duration);
      })
      //////////////////// Essential Event Finish ///////////////////////
      widget.bind(SC.Widget.Events.FINISH, function(){
        //var div = document.getElementById('next')
        //div.setAttribute("ng-init", "usersCtrl.nextsong()")
        function simulateClick() {
          var event = new MouseEvent('click', {
            'view': window,
            'bubbles': true,
            'cancelable': true
          });
          var cb = document.getElementById('next');
          var canceled = !cb.dispatchEvent(event);
          if (canceled) {
            // A handler called preventDefault.
            alert("canceled");
          } else {
            // None of the handlers called preventDefault.
            console.log("this shit fired off");
          }
        }
        simulateClick()
        //console.log("the finish thing is happening!!!!!!!!");
      })
      //////////////////// Essential Event Finish ///////////////////////
      // var div = document.getElementById('next')
      // div.setAttribute("ng-click", "usersCtrl.nextsong()")
    });
  }());
</script>
<button type="button" id="next" name="button" ng-click="usersCtrl.nextsong()">Next Song</button>


<form>
  <div class="form-group">
    <input class="form-control" ng-model="usersCtrl.artist.name" type="text" placeholder="an artist">
    <button class="btn btn-primary form-control" type="submit" ng-click="usersCtrl.getArtist(usersCtrl.artist)">Get Songs</button>
  </div>

</form>
<br>
<br>


<h2>find a song: Search Artist or Song Name</h2>
<label>Search: <input ng-model="searchText"></label>

<table id="searchTextResults" class="table">
    <thead>
        <tr>
            <th>Songs to add</th>
        </tr>
    </thead>
    <tbody>
        <tr ng-repeat="s in usersCtrl.songs | filter:searchText">
            <td><a href="#" ng-click="usersCtrl.addtoPL({songId:s.id, playlistId:usersCtrl.playlist._id, playlist:usersCtrl.playlist})">{{s.title}}</a></td>
        </tr>
    </tbody>
</table>

<h1>Songs on the playlist</h1>
<h1>{{usersCtrl.playlist.name}}</h1>
<label>Search: <input ng-model="searchText"></label>

<table id="searchTextResults" class="table">
    <thead>
        <tr>
            <th>Songs On the playlist</th>
        </tr>
    </thead>
    <tbody>
        <tr ng-repeat="s in usersCtrl.playlist.songs | filter:searchText">
            <td>
              {{s.id}}
              <button type="button" ng-clic="usersCtrl.removeSong()" name="button">Remove Song</button>
            </td>
        </tr>
    </tbody>
</table>
